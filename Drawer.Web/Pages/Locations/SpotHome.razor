@using Drawer.Web.Authentication
@using Drawer.Web.Pages.Locations.Models
@attribute [Route(Paths.SpotHome)]

<ContentTitle Text="자리" />
<AuthorizeView Context="AuthorizeView" Policy="@Policies.CompanyMember">
    <NotAuthorized>
        <NeedCompany />
    </NotAuthorized>
    <Authorized>
        <AidToolBar>
            <AidButton Disabled="@(!canRead)"
                       Color="Color.Secondary"
                       StartIcon="@Icons.Material.Filled.Refresh"
                       OnClick=@(() => Load_Click())>
                조회
            </AidButton>
            <AidButton Disabled="@(!canCreate)"
                       Color="Color.Primary"
                       StartIcon="@Icons.Material.Filled.Add"
                       OnClick=@(() => Add_Click())>
                추가
            </AidButton>
            <AidButton Disabled="@(!canUpdate)"
                       Color="Color.Primary"
                       StartIcon="@Icons.Material.Filled.Update"
                       OnClick=@(() => Update_Click())>
                수정
            </AidButton>
            <AidButton Disabled="@(!canDelete)"
                       Color="Color.Warning"
                       StartIcon="@Icons.Material.Filled.Delete"
                       OnClick=@(() => Delete_Click())>
                삭제
            </AidButton>
            <AidButton Disabled="@(!canCreate)"
                       Color="Color.Info"
                       StartIcon="@Icons.Material.Filled.Queue"
                       OnClick=@(() => BatchEdit_Click())>
                일괄 추가
            </AidButton>
            <AidButton Disabled="@(!canRead)"
                       Color="Color.Info"
                       StartIcon="@Icons.Material.Filled.Download"
                       OnClick=@(() => Download_ClickAsync())>
                엑셀 다운로드
            </AidButton>

            <MudSpacer />

            <AidSearchInput @bind-Value="@searchText" />
        </AidToolBar>

        <AidTable @ref="_table"
                  Loading="@_isTableLoading"
                  T="@SpotTableModel"
                  Items="@_spotList"
                  Filter="@(new Func<SpotTableModel,bool>(FilterSpots))">
            <HeaderContent>
                <MudTHeadRow>
                    <MudTh>
                        <MudTableSortLabel T="SpotTableModel"
                                           SortBy="(x) => x.Name">이름</MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        <MudTableSortLabel T="SpotTableModel"
                                           SortBy="(x) => x.Note">비고</MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        <MudTableSortLabel T="SpotTableModel"
                                           SortBy="(x) => x.WorkPlaceName">작업장</MudTableSortLabel>
                    </MudTh>
                    <MudTh>
                        <MudTableSortLabel T="SpotTableModel"
                                           SortBy="(x) => x.ZoneName">구역</MudTableSortLabel>
                    </MudTh>
                </MudTHeadRow>
            </HeaderContent>

            <RowTemplate>
                <MudTd DataLabel="이름">
                    <MudHighlighter Text="@context.Name" HighlightedText="@searchText" />
                </MudTd>
                <MudTd DataLabel="비고">
                    <MudHighlighter Text="@context.Note" HighlightedText="@searchText" />
                </MudTd>
                <MudTd DataLabel="작업장">
                    <MudHighlighter Text="@context.WorkPlaceName" HighlightedText="@searchText" />
                </MudTd>
                <MudTd DataLabel="구역">
                    <MudHighlighter Text="@context.ZoneName" HighlightedText="@searchText" />
                </MudTd>
            </RowTemplate>

            <FooterContent>
                <MudTFootRow>
                    <MudTd colSpan="100">총 @(TotalRowCount)개의 행</MudTd>
                </MudTFootRow>
            </FooterContent>
        </AidTable>
    </Authorized>
</AuthorizeView>
